
# 财务数据中心需求规格说明书 (v4.2)

**项目名称**：Finance Master 集团财务数据中心
**最后更新**：2025-05-27
**状态**：已发布 (迭代 v4.2 - 性能架构升级与多轮对话)

---

## 1. 产品愿景

打造一个**“不仅能看账，还能自动对账”**的智能财务工作台。
通过纯前端技术栈，解决集团内多主体（上市/非上市）之间财务数据割裂、关联交易核对繁琐、历史数据难以回溯的问题。让财务人员从 Excel 的 VLOOKUP 中解放出来，专注于经营分析与合规管控。

---

## 2. 核心业务实体

### 2.1 主体架构
系统需支持多主体切换，默认配置：
1.  **上市主体**（中移成都信息通信科技）：作为集团内的**买方/甲方**角色，重点关注成本/费用入账。
2.  **非上市主体**（成研分公司）：作为集团内的**卖方/乙方**角色，重点关注收入确认。

### 2.2 数据模型
*   **Ledger (流水)**：凭证级最细颗粒度数据。
*   **Balance (余额)**：科目级汇总数据，支持“上年同期期末余额”字段。

---

## 3. 功能需求 (Functional Requirements)

### 3.1 数据持久化与管理 (Data Hub)
*   **[已完成] 本地数据库**：使用 IndexedDB 存储导入的财务数据，支持按主体隔离。
*   **[已完成] 导入历史**：记录每次导入的文件名、时间、条数，方便追溯。
*   **[已完成] 状态持久化**：刷新页面后记住当前选择的账套主体。
*   **[已完成] 批次撤销 (Rollback)**：支持按导入批次删除错误数据，无需清空全库。
*   **[已完成 v4.0] Excel 解析 Web Worker 化**：将 Excel 文件解析任务移至后台线程。
*   **[已完成 v4.1] 全库备份与恢复 (Backup & Restore)**：支持 JSON 格式全库备份与恢复。

### 3.2 性能与架构 (Performance & Architecture) - NEW
*   **[已完成 v4.2] AI 向量计算 Web Worker 化**：
    *   **痛点解决**：解决在浏览器端进行本地模型 (Transformers.js) 推理时导致 UI 假死的问题。
    *   **实现方式**：将 Embedding 向量化过程移至独立 Worker 线程，实现“非阻塞式”大文件处理。
*   **[已完成 v4.2] 渲染性能优化**：
    *   保持严格的分页策略 (50条/页)，确保在大数据量下的 DOM 渲染流畅度。

### 3.3 首页看板与对账 (Dashboard)
*   **[已完成] 经营概览**：基于配置的收入/成本科目，实时计算累计营收、毛利。支持环比 (MoM) 与同比 (YoY) 分析。
*   **[已完成] 关联交易雷达**：动态切换“成本 vs 收入”方向，基于代码与名称智能匹配。
*   **[已完成] 智能异常检测 (Anomaly Detection)**：集成 AI 自动分析月度财务趋势，标记异常波动。
*   **[已完成] 凭证级智能匹配**：支持下钻到具体月份，拉取双方凭证列表，基于金额和摘要进行 AI 勾稽。
*   **[已完成 v4.1] 隐私模式 (Privacy Mode)**：一键隐藏所有金额敏感信息。

### 3.4 报表查询与分析 (Reporting)
*   **[已完成 v4.2] 智能财务助手 (AI Copilot)**：
    *   **多轮对话**：从单次搜索升级为多轮对话模式，AI 能够记住上下文（如“上个月呢？”）。
    *   **思维链 (CoT)**：展示 AI 的思考过程和数据引用来源。
*   **[已完成] 自然语言查询 (NLQ)**：自动将自然语言转换为筛选条件。
*   **[已完成] 多维透视**：余额表支持“财务视角”与“管理视角”切换。
*   **[已完成] 凭证深度还原**：聚合显示凭证下的所有分录。

---

## 4. 后续规划 (v5.0 - 预算管控与预测)

### 4.1 预算管理 (Budgeting)
- [ ] **预算导入**：支持导入年度部门预算表。
- [ ] **预实对比**：自动计算 实际 vs 预算 的执行率与偏差。

### 4.2 现金流预测 (Cashflow)
- [ ] **收支预测**：基于历史账期的收付款规律，预测未来 3 个月的现金流缺口。

---

## 5. 交互设计原则
*   **Context Aware**：始终提示当前操作主体，通过颜色区分（上市-绿/非上市-蓝）。
*   **Strict Isolation**：主体间的数据与操作状态必须严格物理隔离。


# 财务数据中心需求规格说明书 (v3.1)

**项目名称**：Finance Master 集团财务数据中心
**最后更新**：2025-05-20
**状态**：开发中 (迭代 v3.1)

---

## 1. 产品愿景

打造一个**“不仅能看账，还能自动对账”**的智能财务工作台。
通过纯前端技术栈，解决集团内多主体（上市/非上市）之间财务数据割裂、关联交易核对繁琐、历史数据难以回溯的问题。让财务人员从 Excel 的 VLOOKUP 中解放出来，专注于经营分析与合规管控。

---

## 2. 核心业务实体

### 2.1 主体架构
系统需支持多主体切换，默认配置：
1.  **上市主体**：中移（成都）信息通信科技有限公司（简称：成研院）
    *   *角色特征*：通常作为服务的提供方（收入方）或资金的出资方。
2.  **非上市主体**：中国移动通信集团有限公司成都产业研究院分公司（简称：成研分公司）
    *   *角色特征*：通常涉及房屋资产运营、分公司独立核算。

### 2.2 数据模型
*   **Ledger (流水)**：凭证级最细颗粒度数据。
    *   关键字段：`entityId`, `period`, `voucherNo`, `subjectCode`, `debit`, `credit`, `counterparty`, `summary`.
*   **Balance (余额)**：科目级汇总数据。
    *   关键字段：`entityId`, `period`, `subjectCode`, `opening`, `closing`, `costCenter` (部门), `counterparty` (客商).

---

## 3. 功能需求 (Functional Requirements)

### 3.1 数据持久化与管理 (Data Hub)
*   **[已完成] 本地数据库**：使用 IndexedDB 存储导入的财务数据，支持按主体隔离。
*   **[已完成] 导入历史**：记录每次导入的文件名、时间、条数，方便追溯。
*   **[已完成] 状态持久化**：刷新页面后记住当前选择的账套主体。
*   **[待规划] 数据版本管理**：支持删除错误导入的批次（Rollback）。

### 3.2 首页看板与对账 (Dashboard)
*   **[已完成] 经营概览**：基于配置的收入/成本科目，实时计算累计营收、毛利。
*   **[已完成] 关联交易雷达 (Inter-company Radar)**：
    *   **逻辑**：
        *   取 A 公司对 B 公司的往来收入（Credit Sum of Income Subjects where Counterparty = B）。
        *   取 B 公司对 A 公司的往来成本（Debit Sum of Cost Subjects where Counterparty = A）。
    *   **阈值**：差额绝对值 < 1 元视为“平”，否则视为“异常”。
*   **[已完成] 月度差异穿透**：点击异常项，弹窗展示逐月对比明细，高亮显示差异月份。

### 3.3 报表查询 (Reporting)
*   **[已完成] 余额表多维透视**：
    *   支持按“部门”聚合：查看各部门费用消耗。
    *   支持按“客商”聚合：查看各供应商/客户余额。
*   **[已完成] 明细账钻取**：从余额表点击科目，自动跳转至明细账并带入筛选条件。

---

## 4. 待实现功能 (Todo List)

为了进一步提升系统的实用性和智能化，以下功能已被列入开发计划：

### 4.1 业财融合 (v3.2 计划)
- [ ] **资产地图 (Asset Map)**：
  - 功能：可视化展示楼宇/房间的出租状态。
  - 关联：将财务收入（租金科目）挂载到具体的房间号上，计算单平米收益。
- [ ] **合同台账 OCR (Contract Scan)**：
  - 功能：使用 Gemini AI 自动识别上传的 PDF 合同。
  - 产出：提取合同金额、付款周期、起止时间，生成“应收计划表”。

### 4.2 数据管理增强 (v3.3 计划)
- [ ] **批量删除与回滚**：
  - 痛点：目前如果导错报表，只能清空全库。
  - 方案：增加“按导入批次删除”功能。
- [ ] **报表导出**：
  - 功能：将筛选后的明细账、对账结果差异表导出为 Excel。

---

## 5. 交互设计原则
*   **Context Aware**：始终在界面显眼处提示当前操作的是哪个主体（上市 vs 非上市），通过颜色（绿色/蓝色）区分，防止录错账。
*   **Drill Down**：所有汇总数据均应支持点击穿透到明细。

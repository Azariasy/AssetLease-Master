
# Finance Master - 集团财务数据中心 (v3.7 + Performance Patch)

**Finance Master** 是一个专为集团型企业设计的轻量级财务数据分析与对账工具。它基于现代 Web 技术构建，完全运行在浏览器端，通过 IndexedDB 实现数据本地持久化，确保财务数据绝不离开用户电脑，安全且高效。

当前版本专门针对 **中移（成都）信息通信科技有限公司（成研院）** 与 **中国移动通信集团有限公司成都产业研究院分公司（成研分公司）** 的双主体架构进行了深度定制。

---

## 📅 项目进度与版本历史

### v4.0 (进行中) - 智能化与性能优化
- [x] **Web Workers 异步解析**：重构了 Excel 导入引擎，将解析逻辑移至后台 Worker 线程。现在导入 5 万行以上的大文件时，界面依然流畅丝滑，不再卡顿。

### v3.7 (当前版本) - 体验与智能升级
- [x] **智能异常检测 (Anomaly Detection)**：**[已上线]** 集成 AI 助手。系统可自动扫描月度财务趋势，如果某个月的成本（如办公费）环比激增或利润率异常，AI 会在看板上主动生成诊断报告，辅助财务人员发现风险。
- [x] **凭证完整还原**：点击任意凭证号，弹窗展示该凭证下的所有借贷方分录，自动检查平衡。
- [x] **余额表同比增强**：支持“上年同期期末余额”字段解析与树状展示。
- [x] **全站表头吸顶**：优化长列表浏览体验。
- [x] **树状交互重构**：修复多级科目折叠逻辑。

### v3.5 - 逻辑修正与数据隔离
- [x] **对账方向修正**：上市主体看“我方成本 vs 对方收入”，非上市主体看“我方收入 vs 对方成本”。
- [x] **筛选状态隔离**：主体间筛选条件物理隔离。
- [x] **智能凭证匹配**：基于金额和摘要的 AI 勾稽。

### v3.0 - 架构重构
- [x] **多主体架构**：支持“上市”与“非上市”多套账套。
- [x] **本地数据库**：IndexedDB 实现百万级数据存储。

---

## 🔜 下一步工作规划 (v4.0 重点)

### 1. 自然语言查询 (Natural Language Query)
> *"帮我看看上个月研发部有哪些超过 10 万的差旅费？"*
- **现状**：目前的筛选需要组合多个下拉框和输入框，操作繁琐。
- **计划**：引入 AI 搜索框。用户只需输入自然语言，AI 将其自动转换为复杂的 SQL-like 查询条件，直接展示筛选结果。

### 2. 自定义分析维度
- **计划**：实现动态透视功能，允许用户拖拽改变分组顺序（例如：先按“部门”分组，再按“科目”分组），满足按部门考核预算的需求。

---

## 核心功能亮点

### 1. 双主体智能对账
系统内置了 **成研院** 与 **成研分公司** 的互认逻辑。
- **方向自动识别**：系统知道上市主体是买方（付钱），非上市主体是卖方（收钱），自动调整借贷方取数逻辑。
- **代码级匹配**：除了名称匹配，还内置了 `391310` 和 `012610` 等公司段代码匹配。

### 2. 沉浸式财务分析
- **趋势分析**：自动提取收入与成本科目，生成经营利润趋势图。
- **无感记忆**：您的筛选习惯会被系统自动记住。

### 3. 数据安全与隐私
- **零上传**：所有 Excel/CSV 文件解析均在浏览器内存中完成。
- **本地存储**：数据存储于浏览器内置的 IndexedDB 中，不经过任何云端服务器。

---

## 🚀 快速开始

1. **环境准备**：
   - 推荐使用 Chrome 或 Edge 浏览器。
   - 直接打开 `index.html` 即可运行。

2. **数据导入**：
   - 切换主体 -> 进入“数据导入” -> 上传《科目余额表》和《账户明细表》。

3. **智能体验**：
   - 在“看板与对账”页，尝试点击 **“AI 异常检测”** 按钮，体验 v3.7 的最新功能。

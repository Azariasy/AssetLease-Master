
# 财务数据中心需求规格说明书 (v4.1)

**项目名称**：Finance Master 集团财务数据中心
**最后更新**：2025-05-26
**状态**：已发布 (迭代 v4.1 - 部署准备与安全加固)

---

## 1. 产品愿景

打造一个**“不仅能看账，还能自动对账”**的智能财务工作台。
通过纯前端技术栈，解决集团内多主体（上市/非上市）之间财务数据割裂、关联交易核对繁琐、历史数据难以回溯的问题。让财务人员从 Excel 的 VLOOKUP 中解放出来，专注于经营分析与合规管控。

---

## 2. 核心业务实体

### 2.1 主体架构
系统需支持多主体切换，默认配置：
1.  **上市主体**（中移成都信息通信科技）：作为集团内的**买方/甲方**角色，重点关注成本/费用入账。
2.  **非上市主体**（成研分公司）：作为集团内的**卖方/乙方**角色，重点关注收入确认。

### 2.2 数据模型
*   **Ledger (流水)**：凭证级最细颗粒度数据。
*   **Balance (余额)**：科目级汇总数据，支持“上年同期期末余额”字段。

---

## 3. 功能需求 (Functional Requirements)

### 3.1 数据持久化与管理 (Data Hub)
*   **[已完成] 本地数据库**：使用 IndexedDB 存储导入的财务数据，支持按主体隔离。
*   **[已完成] 导入历史**：记录每次导入的文件名、时间、条数，方便追溯。
*   **[已完成] 状态持久化**：刷新页面后记住当前选择的账套主体。
*   **[已完成] 批次撤销 (Rollback)**：支持按导入批次删除错误数据，无需清空全库。
*   **[已完成 v4.0] Web Worker 异步解析**：将 Excel 文件解析任务移至后台线程，防止大文件导入时 UI 卡死，大幅提升性能。
*   **[已完成 v4.1] 全库备份与恢复 (Backup & Restore)**：
    *   支持将 IndexedDB 中的所有账套数据导出为 JSON 备份文件。
    *   支持从备份文件恢复数据，确保在清理缓存或更换电脑时数据不丢失。

### 3.2 首页看板与对账 (Dashboard)
*   **[已完成] 经营概览**：基于配置的收入/成本科目，实时计算累计营收、毛利。支持环比 (MoM) 与同比 (YoY) 分析。
*   **[已完成] 关联交易雷达**：动态切换“成本 vs 收入”方向，基于代码与名称智能匹配。
*   **[已完成] 智能异常检测 (Anomaly Detection)**：集成通义千问 AI，自动分析月度财务趋势，标记异常波动。
*   **[已完成] 凭证级智能匹配**：支持下钻到具体月份，拉取双方凭证列表，基于金额和摘要进行 AI 勾稽。
*   **[已完成 v4.1] 隐私模式 (Privacy Mode)**：
    *   提供全局开关，一键隐藏所有金额敏感信息（显示为 `****`），便于在公共场合演示或汇报。
*   **[已完成 v4.1] 骨架屏加载 (Skeleton Loading)**：
    *   优化加载体验，在数据计算或 AI 分析时展示脉冲骨架屏，提升应用质感。

### 3.3 报表查询与分析 (Reporting)
*   **[已完成 v4.0] 自然语言查询 (NLQ)**：在明细账页面支持 AI 语义搜索。用户输入“查询研发部大于10万的差旅费”，系统自动转换为筛选条件。
*   **[已完成 v4.0] 多维透视 (Dynamic Grouping)**：余额表支持“财务视角 (科目树)”与“管理视角 (部门 -> 科目)”动态切换。
*   **[已完成] 余额表同比分析**：支持解析并展示“上年同期期末余额”，辅助进行年度对比。
*   **[已完成] 树状交互优化**：实现了递归折叠逻辑，保持视图整洁。
*   **[已完成] 凭证深度还原**：在明细账中点击“凭证号”，聚合显示该凭证下的**所有分录**（借贷方全貌），检查借贷平衡。
*   **[已完成 v4.1] 搜索防抖 (Debounce)**：
    *   优化高频搜索输入体验，输入停止 300ms 后再执行查询，避免大量数据下的卡顿。

### 3.4 用户体验与状态管理 (UX)
*   **[已完成] 筛选状态隔离**：不同主体的筛选条件相互独立且持久化。
*   **[已完成] 固定表头 (Sticky Headers)**：优化全站表格布局，支持大数据量滚动。

---

## 4. 后续规划 (v5.0 - 预算管控与预测)

### 4.1 预算管理 (Budgeting)
- [ ] **预算导入**：支持导入年度部门预算表。
- [ ] **预实对比**：在余额表“管理视角”下，自动计算 实际 vs 预算 的执行率与偏差。

### 4.2 现金流预测 (Cashflow)
- [ ] **收支预测**：基于历史账期的收付款规律，预测未来 3 个月的现金流缺口。

---

## 5. 交互设计原则
*   **Context Aware**：始终提示当前操作主体，通过颜色区分（上市-绿/非上市-蓝）。
*   **Strict Isolation**：主体间的数据与操作状态必须严格物理隔离。
